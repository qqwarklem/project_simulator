<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ–±-—Å–∏–º—É–ª—è—Ç–æ—Ä —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ø–µ–π</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --dark: #1a252f;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .app-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .app-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .app-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 20px;
            height: calc(100vh - 200px);
        }
        
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow-y: auto;
        }
        
        .visualization-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        
        .panel-group {
            margin-bottom: 25px;
            border: 1px solid var(--gray);
            border-radius: 10px;
            padding: 15px;
            background: var(--light);
        }
        
        .panel-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 1.1rem;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
        }
        
        select, input, button {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray);
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        button:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-danger {
            background: var(--accent);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .circuit-display {
            flex: 1;
            border: 2px dashed var(--gray);
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            background: #f8f9fa;
            min-height: 300px;
            overflow: auto;
        }
        
        .results-display {
            background: var(--primary);
            color: white;
            padding: 15px;
            border-radius: 10px;
            min-height: 100px;
        }
        
        .component {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    cursor: move;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    text-align: center;
    font-size: 11px;
    padding: 5px;
    z-index: 10;
    border: 2px solid white;
}

        
        .component:hover {
    transform: scale(1.05);
    z-index: 20;
}
        
        .resistor { background: #e74c3c; }
        .capacitor { background: #3498db; }
        .inductor { background: #27ae60; }
        .voltage-source { background: #f39c12; }
        .current-source { background: #9b59b6; }
        .diode { background: #e67e22; }
        
        .connection-series {
            position: absolute;
            height: 3px;
            background: var(--dark);
            transform-origin: left center;
        }
        .connection-line {
    position: absolute;
    height: 2px;
    background: #2c3e50;
    transform-origin: left center;
    z-index: 1;
}

        .connection-parallel {
    border-bottom: 2px dashed #e74c3c;
}

/* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –∑–≤–µ–∑–¥—ã –∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ */
        .connection-vertical {
    position: absolute;
    width: 2px;
    background: #2c3e50;
    transform-origin: top center;
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π */
        .connection-node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--dark);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .status-bar {
            background: var(--success);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .plot-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--gray);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .component-counter {
            display: inline-block;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            margin-left: 5px;
        }
        .hidden {
            display: none !important;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>üß™ –í–µ–±-—Å–∏–º—É–ª—è—Ç–æ—Ä —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ø–µ–π</h1>
            <p>–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–Ω–∞–ª–∏–∑ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Å—Ö–µ–º</p>
        </header>
        
        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="control-panel">
                <div class="panel-group">
                    <div class="panel-title">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</div>
                    <div class="form-group">
                        <label for="componentType">–¢–∏–ø –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:</label>
                        <select id="componentType">
                            <option value="resistor">–†–µ–∑–∏—Å—Ç–æ—Ä</option>
                            <option value="capacitor">–ö–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä</option>
                            <option value="inductor">–ö–∞—Ç—É—à–∫–∞ –∏–Ω–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</option>
                            <option value="voltage-source">–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è</option>
                            <option value="current-source">–ò—Å—Ç–æ—á–Ω–∏–∫ —Ç–æ–∫–∞</option>
                            <option value="diode">–î–∏–æ–¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="componentValue">–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                        <input type="text" id="componentValue" value="1000">
                        <small id="valueUnit">–û–º</small>
                    </div>
                    <div class="form-group">
                        <label for="connectionType">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:</label>
                        <select id="connectionType">
                            <option value="series">–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ</option>
                            <option value="parallel">–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ</option>
                            <option value="star">–ó–≤–µ–∑–¥–∞</option>
                            <option value="delta">–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="addComponentBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <button id="deleteComponentBtn" class="btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <div class="button-group">
                        <button id="clearCircuitBtn" class="btn-warning">–û—á–∏—Å—Ç–∏—Ç—å —Å—Ö–µ–º—É</button>
                    </div>
                </div>
                
                <div class="panel-group">
                    <div class="panel-title">–°–∏–º—É–ª—è—Ü–∏—è</div>
                    <div class="form-group">
                        <label for="simulationType">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞:</label>
                        <select id="simulationType">
                            <option value="rc">RC-—Ü–µ–ø—å</option>
                            <option value="rlc">RLC-—Ü–µ–ø—å</option>
                            <option value="frequency">–ê–ß–• –∞–Ω–∞–ª–∏–∑</option>
                            <option value="transient">–ü–µ—Ä–µ—Ö–æ–¥–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</option>
                            <option value="impulse">–ò–º–ø—É–ª—å—Å–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</option>
                            <option value="noise">–®—É–º–æ–≤–æ–π –∞–Ω–∞–ª–∏–∑</option>
                        </select>
                    </div>
                    <button id="runSimulationBtn" class="btn-success">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é</button>
                </div>
                
                <div class="panel-group">
                    <div class="panel-title">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å—Ö–µ–º</div>
                    <div class="form-group">
                        <label for="circuitLibrary">–ì–æ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã:</label>
                        <select id="circuitLibrary">
                            <option value="rc-lpf">RC –§–ù–ß</option>
                            <option value="rc-hpf">RC –§–í–ß</option>
                            <option value="rlc-resonance">RLC –†–µ–∑–æ–Ω–∞–Ω—Å</option>
                            <option value="bandpass-rlc">–ü–æ–ª–æ—Å–æ–≤–æ–π RLC</option>
                            <option value="voltage-divider">–î–µ–ª–∏—Ç–µ–ª—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è</option>
                            <option value="rc-integrator">–ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä RC</option>
                            <option value="rc-differentiator">–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ç–æ—Ä RC</option>
                            <option value="parallel-resonance">–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Ä–µ–∑–æ–Ω–∞–Ω—Å</option>
                            <option value="star-connection">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–≤–µ–∑–¥–æ–π</option>
                        </select>
                    </div>
                    <button id="loadCircuitBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É</button>
                </div>
                
                <div class="panel-group">
                    <div class="panel-title">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤</div>
                    <div class="form-group">
                        <label for="signalType">–§–æ—Ä–º–∞ —Å–∏–≥–Ω–∞–ª–∞:</label>
                        <select id="signalType">
                            <option value="sine">–°–∏–Ω—É—Å</option>
                            <option value="square">–ú–µ–∞–Ω–¥—Ä</option>
                            <option value="sawtooth">–ü–∏–ª–∞</option>
                            <option value="triangle">–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫</option>
                            <option value="impulse">–ò–º–ø—É–ª—å—Å</option>
                            <option value="noise">–®—É–º</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="signalFrequency">–ß–∞—Å—Ç–æ—Ç–∞:</label>
                        <select id="signalFrequency">
                            <option value="1">1 –ì—Ü</option>
                            <option value="10">10 –ì—Ü</option>
                            <option value="100">100 –ì—Ü</option>
                            <option value="1000" selected>1 –∫–ì—Ü</option>
                            <option value="10000">10 –∫–ì—Ü</option>
                            <option value="100000">100 –∫–ì—Ü</option>
                            <option value="1000000">1 –ú–ì—Ü</option>
                        </select>
                    </div>
                    <button id="showOscilloscopeBtn">–û—Ç–∫—Ä—ã—Ç—å –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ</button>
                </div>
                
                <div class="panel-group">
                    <div class="panel-title">–§–∞–π–ª—ã</div>
                    <div class="button-group">
                        <button id="saveCircuitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É</button>
                        <button id="loadCircuitFileBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É</button>
                    </div>
                    <button id="exportImageBtn" class="btn-warning">–≠–∫—Å–ø–æ—Ä—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
                </div>
                
                <div class="status-bar" id="statusBar">
                    –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª–∞.
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –æ–±–ª–∞—Å—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
            <div class="visualization-area">
                <div class="tab-container">
                    <div class="tab active" data-tab="circuit">–°—Ö–µ–º–∞</div>
                    <div class="tab" data-tab="oscilloscope">–û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ</div>
                    <div class="tab" data-tab="analysis">–ê–Ω–∞–ª–∏–∑</div>
                </div>
                
                <div class="tab-content active" id="circuit-tab">
                    <div class="circuit-display" id="circuitDisplay">
                        <!-- –°—Ö–µ–º–∞ –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                    
                    <div class="results-display" id="resultsDisplay">
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–º—É–ª—è—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
                    </div>
                </div>
                
                <div class="tab-content" id="oscilloscope-tab">
                    <div class="plot-container" id="oscilloscopePlot">
                        <!-- –û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="tab-content" id="analysis-tab">
                    <div class="plot-container" id="analysisPlot">
                        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let components = [];
        let nextComponentId = 1;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            updateStatus();
            updateValueUnit(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function initializeEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
            document.getElementById('addComponentBtn').addEventListener('click', addComponent);
            document.getElementById('deleteComponentBtn').addEventListener('click', deleteLastComponent);
            document.getElementById('clearCircuitBtn').addEventListener('click', clearCircuit);
            
            // –ö–Ω–æ–ø–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏
            document.getElementById('runSimulationBtn').addEventListener('click', runSimulationBackend); // –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–£ –°–¢–†–û–ö–£
            document.getElementById('loadCircuitBtn').addEventListener('click', loadFromLibrary);
            
            // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤
            document.getElementById('showOscilloscopeBtn').addEventListener('click', showOscilloscopeBackend); // –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–£ –°–¢–†–û–ö–£
            
            // –§–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            document.getElementById('saveCircuitBtn').addEventListener('click', saveCircuitBackend); // –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–£ –°–¢–†–û–ö–£
            document.getElementById('loadCircuitFileBtn').addEventListener('click', loadCircuit);
            document.getElementById('exportImageBtn').addEventListener('click', exportImage);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
            document.getElementById('componentType').addEventListener('change', updateValueUnit);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
        function updateValueUnit() {
            const type = document.getElementById('componentType').value;
            const unitElement = document.getElementById('valueUnit');
            const valueInput = document.getElementById('componentValue');
            
            const units = {
                'resistor': '–û–º',
                'capacitor': '–§',
                'inductor': '–ì–Ω',
                'voltage-source': '–í',
                'current-source': '–ê',
                'diode': '–í'
            };
            
            const defaultValues = {
                'resistor': '1000',
                'capacitor': '0.000001',
                'inductor': '0.001',
                'voltage-source': '5',
                'current-source': '0.1',
                'diode': '0.7'
            };
            
            unitElement.textContent = units[type] || '';
            valueInput.value = defaultValues[type] || '';
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        function addComponent() {
            const type = document.getElementById('componentType').value;
            const value = parseFloat(document.getElementById('componentValue').value);
            const connection = document.getElementById('connectionType').value;
            
            if (isNaN(value) || value <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!');
                return;
            }
            
            const component = {
                id: nextComponentId++,
                type: type,
                value: value,
                connection: connection,
                x: components.length * 80 + 50,
                y: 100
            };
            
            components.push(component);
            renderCircuit();
            updateStatus();
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        function deleteLastComponent() {
            if (components.length === 0) {
                alert('–ù–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!');
                return;
            }
            
            components.pop();
            renderCircuit();
            updateStatus();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Å—Ö–µ–º—ã
        function clearCircuit() {
            if (components.length === 0) {
                alert('–°—Ö–µ–º–∞ —É–∂–µ –ø—É—Å—Ç–∞!');
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ö–µ–º—É?')) {
                components = [];
                renderCircuit();
                updateStatus();
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ö–µ–º—ã
// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ö–µ–º—ã —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ö–µ–º—ã
function renderCircuit() {
    const display = document.getElementById('circuitDisplay');
    display.innerHTML = '';
    
    const centerY = 150;
    const spacing = 80;
    
    // –†–∏—Å—É–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ª–∏–Ω–∏—é
    if (components.length > 0) {
        const startX = 50;
        const endX = components.length * spacing + 50;
        drawLine(display, startX, centerY, endX, centerY, 'connection-line');
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    components.forEach((comp, index) => {
        const x = 50 + index * spacing;
        comp.x = x; // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        comp.y = centerY - 30;
        
        const compElement = document.createElement('div');
        compElement.className = `component ${comp.type}`;
        compElement.style.left = `${x}px`;
        compElement.style.top = `${centerY - 30}px`;
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        let displayValue = formatValue(comp.value);
        
        // –°–∏–º–≤–æ–ª—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
        const symbols = {
            'resistor': 'R', 'capacitor': 'C', 'inductor': 'L',
            'voltage-source': 'V', 'current-source': 'I', 'diode': 'D'
        };
        
        const connSymbols = {
            'series': '‚Üí', 'parallel': '‚à•', 'star': 'Y', 'delta': 'Œî'
        };
        
        compElement.innerHTML = `
            <div>${symbols[comp.type]}${index+1}</div>
            <div>${displayValue}</div>
            <div style="font-size:9px;opacity:0.8;">${connSymbols[comp.connection]}</div>
        `;
        
        // –†–∏—Å—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        drawComponentConnections(comp, display, x, centerY);
        
        makeDraggable(compElement, comp);
        display.appendChild(compElement);
    });
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
function formatValue(value) {
    if (value >= 1e6) return (value / 1e6).toFixed(1) + 'M';
    if (value >= 1e3) return (value / 1e3).toFixed(1) + 'k';
    if (value <= 1e-9) return (value * 1e9).toFixed(1) + 'n';
    if (value <= 1e-6) return (value * 1e6).toFixed(1) + 'Œº';
    if (value <= 1e-3) return (value * 1e3).toFixed(1) + 'm';
    return value.toFixed(1);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ª–∏–Ω–∏–π
function drawLine(display, x1, y1, x2, y2, className) {
    const line = document.createElement('div');
    line.className = className;
    
    const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
    
    line.style.width = `${length}px`;
    line.style.left = `${x1}px`;
    line.style.top = `${y1}px`;
    line.style.transform = `rotate(${angle}deg)`;
    
    display.appendChild(line);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
function drawComponentConnections(comp, display, x, centerY) {
    if (comp.connection === 'parallel') {
        // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ - –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è –Ω–∞–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º
        drawLine(display, x - 25, centerY - 20, x + 25, centerY - 20, 'connection-line connection-parallel');
    } else if (comp.connection === 'star') {
        // –ó–≤–µ–∑–¥–∞ - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É
        drawLine(display, x, centerY, x, centerY - 30, 'connection-vertical');
    } else if (comp.connection === 'delta') {
        // –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ - –¥–≤–µ –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
        drawLine(display, x - 15, centerY - 15, x + 15, centerY - 15, 'connection-line');
        drawLine(display, x - 15, centerY - 15, x, centerY - 45, 'connection-line');
        drawLine(display, x + 15, centerY - 15, x, centerY - 45, 'connection-line');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
function drawSpecialConnections(component, display, centerY) {
    if (component.connection === 'parallel') {
        // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ - —Ä–∏—Å—É–µ–º –æ–±—Ö–æ–¥–Ω—É—é –ª–∏–Ω–∏—é
        const parallelLine = document.createElement('div');
        parallelLine.className = 'connection-parallel';
        parallelLine.style.width = '40px';
        parallelLine.style.left = `${component.x - 20}px`;
        parallelLine.style.top = `${centerY - 15}px`;
        display.appendChild(parallelLine);
        
    } else if (component.connection === 'star') {
        // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–≤–µ–∑–¥–æ–π - —Ä–∏—Å—É–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
        const starLine = document.createElement('div');
        starLine.className = 'connection-vertical';
        starLine.style.height = '30px';
        starLine.style.left = `${component.x}px`;
        starLine.style.top = `${centerY - 30}px`;
        display.appendChild(starLine);
        
    } else if (component.connection === 'delta') {
        // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–º - —Ä–∏—Å—É–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
        const deltaLine1 = document.createElement('div');
        deltaLine1.className = 'connection-series';
        deltaLine1.style.width = '30px';
        deltaLine1.style.left = `${component.x - 15}px`;
        deltaLine1.style.top = `${centerY - 15}px`;
        deltaLine1.style.transform = 'rotate(45deg)';
        display.appendChild(deltaLine1);
        
        const deltaLine2 = document.createElement('div');
        deltaLine2.className = 'connection-series';
        deltaLine2.style.width = '30px';
        deltaLine2.style.left = `${component.x - 15}px`;
        deltaLine2.style.top = `${centerY - 15}px`;
        deltaLine2.style.transform = 'rotate(-45deg)';
        display.appendChild(deltaLine2);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —É–∑–ª–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
function drawConnectionNodes(display, centerY) {
    components.forEach((comp, index) => {
        const node = document.createElement('div');
        node.className = 'connection-node';
        node.style.left = `${comp.x}px`;
        node.style.top = `${centerY}px`;
        display.appendChild(node);
        
        // –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —Ä–∏—Å—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º
        if (index > 0) {
            const prevComp = components[index - 1];
            const connection = document.createElement('div');
            connection.className = `connection-${comp.connection}`;
            
            const length = Math.abs(comp.x - prevComp.x);
            connection.style.width = `${length}px`;
            connection.style.left = `${prevComp.x}px`;
            connection.style.top = `${centerY}px`;
            
            display.appendChild(connection);
        }
    });
}
        
        // –°–¥–µ–ª–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º
        // –°–¥–µ–ª–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º
function makeDraggable(element, component) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    
    element.onmousedown = dragMouseDown;
    
    function dragMouseDown(e) {
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
    }
    
    function elementDrag(e) {
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        
        component.x = element.offsetLeft - pos1;
        component.y = element.offsetTop - pos2;
        
        element.style.top = component.y + "px";
        element.style.left = component.x + "px";
        
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –í–°–ï —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏
        renderCircuit();
    }
    
    function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
    }
}
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus() {
            const statusBar = document.getElementById('statusBar');
            
            if (components.length === 0) {
                statusBar.textContent = '–°—Ö–µ–º–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.';
                statusBar.style.background = '#e74c3c';
            } else {
                // –ü–æ–¥—Å—á–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º
                const typeCount = {};
                components.forEach(comp => {
                    typeCount[comp.type] = (typeCount[comp.type] || 0) + 1;
                });
                
                let statusText = `–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: ${components.length}`;
                for (const type in typeCount) {
                    const typeNames = {
                        'resistor': 'R',
                        'capacitor': 'C', 
                        'inductor': 'L',
                        'voltage-source': 'V',
                        'current-source': 'I',
                        'diode': 'D'
                    };
                    statusText += ` | ${typeNames[type]}: ${typeCount[type]}`;
                }
                
                statusBar.textContent = statusText;
                statusBar.style.background = '#27ae60';
            }
        }

        // === –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ë–≠–ö–ï–ù–î–û–ú ===

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –±—ç–∫–µ–Ω–¥ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
        // –í —Ñ—É–Ω–∫—Ü–∏–∏ runSimulationBackend –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
async function runSimulationBackend() {
    if (components.length === 0) {
        alert('–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Å—Ö–µ–º—É –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∏–º—É–ª—è—Ü–∏–∏!');
        return;
    }
    
    const simulationType = document.getElementById('simulationType').value;
    const resultsDisplay = document.getElementById('resultsDisplay');
    
    resultsDisplay.innerHTML = '<strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–º—É–ª—è—Ü–∏—è...';
    
    try {
        const response = await fetch('/api/simulate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                components: components,
                simulation_type: simulationType
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            if (data.type === 'time_domain') {
                // ‚úÖ –ü–†–û–í–ï–†–Ø–ï–ú –ù–ê–õ–ò–ß–ò–ï –ü–ê–†–ê–ú–ï–¢–†–û–í
                const params = data.parameters || { R: 1000, C: 1e-6, L: 0.001, Vsrc: 1.0 };
                
                resultsDisplay.innerHTML = `
                    <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞<br>
                    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: R=${params.R.toFixed(2)}Œ©, 
                    C=${params.C ? params.C.toExponential(2) + 'F' : 'N/A'}, 
                    L=${params.L ? params.L.toExponential(2) + 'H' : 'N/A'}<br>
                    <img src="data:image/png;base64,${data.image}" style="max-width: 100%; margin-top: 10px;">
                `;
            } else if (data.type === 'frequency') {
                // ‚úÖ –ü–†–û–í–ï–†–Ø–ï–ú –ù–ê–õ–ò–ß–ò–ï –ü–ê–†–ê–ú–ï–¢–†–û–í –î–õ–Ø –ê–ß–•
                const params = data.parameters || { R: 1000, C: 1e-6, L: 0.001 };
                showBodePlot(data.frequencies, data.magnitude, data.phase, params);
            }
        } else {
            resultsDisplay.innerHTML = `<strong>–û—à–∏–±–∫–∞:</strong> ${data.message}`;
        }
    } catch (error) {
        resultsDisplay.innerHTML = `<strong>–û—à–∏–±–∫–∞:</strong> ${error.message}`;
    }
}

// –í —Ñ—É–Ω–∫—Ü–∏–∏ showBodePlot —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
function showBodePlot(frequencies, magnitude, phase, parameters) {
    // ‚úÖ –ó–ê–©–ò–¢–ê –û–¢ –û–¢–°–£–¢–°–¢–í–ò–Ø –ü–ê–†–ê–ú–ï–¢–†–û–í
    const params = parameters || { R: 1000, C: 1e-6, L: 0.001 };
    
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    document.querySelector('[data-tab="analysis"]').classList.add('active');
    document.getElementById('analysis-tab').classList.add('active');
    
    const trace1 = {
        x: frequencies,
        y: magnitude,
        type: 'scatter',
        mode: 'lines',
        name: '–ê–º–ø–ª–∏—Ç—É–¥–∞',
        line: { color: 'blue', width: 2 }
    };
    
    const trace2 = {
        x: frequencies,
        y: phase,
        type: 'scatter',
        mode: 'lines',
        name: '–§–∞–∑–∞',
        line: { color: 'red', width: 2 },
        yaxis: 'y2'
    };
    
    const layout = {
        title: '–ê–ß–• –∏ –§–ß–• —Ü–µ–ø–∏',
        xaxis: { 
            title: '–ß–∞—Å—Ç–æ—Ç–∞, –ì—Ü',
            type: 'log'
        },
        yaxis: { 
            title: '–ê–º–ø–ª–∏—Ç—É–¥–∞, –¥–ë',
            side: 'left'
        },
        yaxis2: {
            title: '–§–∞–∑–∞, –≥—Ä–∞–¥—É—Å—ã',
            side: 'right',
            overlaying: 'y'
        },
        showlegend: true
    };
    
    Plotly.newPlot('analysisPlot', [trace1, trace2], layout, { responsive: true });
    
    document.getElementById('resultsDisplay').innerHTML = 
        `<strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ê–ß–• –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. R=${params.R.toFixed(2)}Œ©, C=${params.C.toExponential(2)}F, L=${params.L.toExponential(2)}H`;
}

        // –û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ —Å —Ä–µ–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é
async function showOscilloscopeBackend() {
    if (components.length === 0) {
        alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É!');
        return;
    }
    
    const signalType = document.getElementById('signalType').value;
    const frequency = parseFloat(document.getElementById('signalFrequency').value);
    
    try {
        const response = await fetch('/api/oscilloscope', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                signal_type: signalType,
                frequency: frequency,
                amplitude: 1.0,
                components: components  // ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É!
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector('[data-tab="oscilloscope"]').classList.add('active');
            document.getElementById('oscilloscope-tab').classList.add('active');
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏
            const trace1 = {
                x: data.time,
                y: data.input_signal,
                type: 'scatter',
                mode: 'lines',
                name: '–í—Ö–æ–¥',
                line: { color: 'blue', width: 2 }
            };
            
            const trace2 = {
                x: data.time,
                y: data.output_signal,
                type: 'scatter',
                mode: 'lines', 
                name: '–í—ã—Ö–æ–¥',
                line: { color: 'red', width: 2 }
            };
            
            const trace3 = {
                x: data.time,
                y: data.current_signal,
                type: 'scatter',
                mode: 'lines',
                name: '–¢–æ–∫',
                line: { color: 'green', width: 1 },
                yaxis: 'y2'
            };
            
            const layout = {
                title: `–û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ: ${signalType} ${frequency} –ì—Ü`,
                xaxis: { title: '–í—Ä–µ–º—è, —Å' },
                yaxis: { title: '–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –í' },
                yaxis2: {
                    title: '–¢–æ–∫, –ê',
                    side: 'right',
                    overlaying: 'y'
                },
                showlegend: true
            };
            
            Plotly.newPlot('oscilloscopePlot', [trace1, trace2, trace3], layout, { responsive: true });
        } else {
            alert('–û—à–∏–±–∫–∞ –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞: ' + data.message);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
        async function saveCircuitBackend() {
            if (components.length === 0) {
                alert('–ù–µ—Ç —Å—Ö–µ–º—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!');
                return;
            }
            
            const filename = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞:', 'circuit.json');
            if (!filename) return;
            
            try {
                const response = await fetch('/api/save_circuit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        components: components,
                        filename: filename
                    })
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    alert(data.message);
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–æ)
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
function loadFromLibrary() {
    const circuitName = document.getElementById('circuitLibrary').value;
    
    components = [];
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å—Ö–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
    const circuitLibrary = {
        'rc-lpf': [
            { type: 'resistor', value: 1000, connection: 'series', x: 100, y: 150 },
            { type: 'capacitor', value: 0.000001, connection: 'parallel', x: 200, y: 150 },
            { type: 'voltage-source', value: 5, connection: 'series', x: 300, y: 150 }
        ],
        'rc-hpf': [
            { type: 'capacitor', value: 0.0000001, connection: 'series', x: 100, y: 150 },
            { type: 'resistor', value: 1000, connection: 'parallel', x: 200, y: 150 },
            { type: 'voltage-source', value: 5, connection: 'series', x: 300, y: 150 }
        ],
        'rlc-resonance': [
            { type: 'resistor', value: 50, connection: 'series', x: 80, y: 150 },
            { type: 'inductor', value: 0.001, connection: 'series', x: 160, y: 150 },
            { type: 'capacitor', value: 0.000001, connection: 'series', x: 240, y: 150 },
            { type: 'voltage-source', value: 10, connection: 'series', x: 320, y: 150 }
        ],
        'bandpass-rlc': [
            { type: 'inductor', value: 0.01, connection: 'series', x: 80, y: 150 },
            { type: 'capacitor', value: 0.0000001, connection: 'series', x: 160, y: 150 },
            { type: 'resistor', value: 100, connection: 'series', x: 240, y: 150 },
            { type: 'voltage-source', value: 5, connection: 'series', x: 320, y: 150 }
        ],
        'voltage-divider': [
            { type: 'resistor', value: 1000, connection: 'series', x: 100, y: 150 },
            { type: 'resistor', value: 1000, connection: 'series', x: 200, y: 150 },
            { type: 'voltage-source', value: 12, connection: 'series', x: 300, y: 150 }
        ],
        'rc-integrator': [
            { type: 'resistor', value: 10000, connection: 'series', x: 100, y: 150 },
            { type: 'capacitor', value: 0.0000001, connection: 'parallel', x: 200, y: 150 },
            { type: 'voltage-source', value: 1, connection: 'series', x: 300, y: 150 }
        ],
        'rc-differentiator': [
            { type: 'capacitor', value: 0.00000001, connection: 'series', x: 100, y: 150 },
            { type: 'resistor', value: 100000, connection: 'parallel', x: 200, y: 150 },
            { type: 'voltage-source', value: 1, connection: 'series', x: 300, y: 150 }
        ],
        'parallel-resonance': [
            { type: 'inductor', value: 0.001, connection: 'parallel', x: 150, y: 150 },
            { type: 'capacitor', value: 0.000001, connection: 'parallel', x: 150, y: 150 },
            { type: 'resistor', value: 1000, connection: 'series', x: 250, y: 150 },
            { type: 'voltage-source', value: 5, connection: 'series', x: 350, y: 150 }
        ],
        'star-connection': [
            { type: 'resistor', value: 1000, connection: 'star', x: 150, y: 100 },
            { type: 'resistor', value: 1000, connection: 'star', x: 100, y: 200 },
            { type: 'resistor', value: 1000, connection: 'star', x: 200, y: 200 },
            { type: 'voltage-source', value: 12, connection: 'series', x: 300, y: 150 }
        ]
    };
    
    if (circuitLibrary[circuitName]) {
        components = JSON.parse(JSON.stringify(circuitLibrary[circuitName]));
        nextComponentId = components.length + 1;
        
        renderCircuit();
        updateStatus();
        
        document.getElementById('resultsDisplay').innerHTML = 
            `<strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—Ö–µ–º–∞ "${document.getElementById('circuitLibrary').options[document.getElementById('circuitLibrary').selectedIndex].text}"`;
    } else {
        alert('–°—Ö–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ!');
    }
}
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–æ)
        function loadCircuit() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        components = JSON.parse(e.target.result);
                        nextComponentId = components.length + 1;
                        renderCircuit();
                        updateStatus();
                        document.getElementById('resultsDisplay').innerHTML = '<strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –°—Ö–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–æ)
        function exportImage() {
            if (components.length === 0) {
                alert('–ù–µ—Ç —Å—Ö–µ–º—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }
            
            alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
        }
    </script>
</body>
</html>